import{L as H}from"./LoaderComponent-2bdc88b3.js";import{_ as V,r as L,o as l,c as r,d as R,n as O,b as a,t as h,F as m,i as y,k as u,v as w,G as M,j as p,l as k,H as U,g as T,w as _}from"./index-bad9476b.js";const{VITE_URL:b,VITE_PATH:g}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"healing_chou",BASE_URL:"/HealingChou/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},B={data(){return{isLoading:!1,months:["January","February","March","April","May","June","July","August","September","October","November","December"],orders:[],tempOrder:{id:"",name:"",phone:"",email:"",message:"",time:0,is_paid:!1,product:{title:"",category:"",id:""}},today:{year:0,month:0,date:0,day:0},calendar:{year:0,month:0,date:0,day:0},courses:[],services:[],closed:[],total_pages:0}},components:{LoaderComponent:H},methods:{getBooked(){this.$http.get(`${b}/api/${g}/admin/orders`).then(o=>{this.total_pages=o.data.pagination.total_pages,this.processBooked()}).catch(o=>{console.log(o)})},async processBooked(){for(let o=1;o<=this.total_pages;o++)await this.getBookedPages(o);this.orders=this.orders.sort((o,t)=>o.user.address-t.user.address),setTimeout(()=>{this.isLoading=!1},1e3)},async getBookedPages(o){return new Promise(t=>{this.$http.get(`${b}/api/${g}/admin/orders?page=${o}`).then(n=>{o==1?this.orders=n.data.orders:this.orders=this.orders.concat(n.data.orders),t()}).catch(n=>{console.log(n)})})},selectTempOrder(o,t){console.log(t);let n;switch(new Date(o).getDay()){case 1:n="(一)";break;case 2:n="(二)";break;case 4:n="(四)";break;case 5:n="(五)";break;case 6:n="(六)";break}let D=new Date(o).toLocaleDateString()+n+" "+new Date(o).toLocaleTimeString("en-GB");this.tempOrder={...t,shownTime:D}},setToday(){const o=new Date;this.today.year=this.calendar.year=o.getFullYear(),this.today.month=this.calendar.month=o.getMonth(),this.today.date=this.calendar.date=o.getDate(),this.today.day=this.calendar.day=o.getDay()},adjustYear(o){this.calendar.year+=o},adjustMonth(o){let t=this.calendar.month+o;t>11?(this.adjustYear(1),this.calendar.month=0):t<0?(this.adjustYear(-1),this.calendar.month=11):this.calendar.month=t},calculateDate(o,t){return new Date(this.calendarMonth[(o-1)*7+t-1].year,this.calendarMonth[(o-1)*7+t-1].month,this.calendarMonth[(o-1)*7+t-1].date)},getProducts(){this.$http.get(`${b}/api/${g}/products/all`).then(o=>{o.data.products.forEach(t=>{t.category=="course"?this.courses.push({title:t.title,id:t.id}):t.category=="service"?this.services.push({title:t.title,id:t.id}):this.closed.push({title:t.title,id:t.id})})}).catch(o=>{console.log(o)})},addToCart(){const o={product_id:this.tempOrder.product.id,qty:1};this.$http.post(`${b}/api/${g}/cart`,{data:o}).then(t=>{this.addOrder()}).catch(t=>{console.log(t)})},addOrder(){const o={user:{name:this.tempOrder.name,email:this.tempOrder.email,tel:this.tempOrder.phone,address:this.tempOrder.time.toString()},message:this.tempOrder.message};this.$http.post(`${b}/api/${g}/order`,{data:o}).then(t=>{alert("已成功預約"),this.getBooked()}).catch(t=>{console.log(t)})},editOrder(){},deleteOrder(o){window.confirm("確定要刪除?")&&this.$http.delete(`${b}/api/${g}/admin/order/${o}`).then(t=>{alert("預約已刪除"),this.isLoading=!0,this.getBooked()}).catch(t=>{console.log(t)})}},computed:{calendarFirstDay(){const o=new Date(this.calendar.year,this.calendar.month,1),t=new Date(this.calendar.year,this.calendar.month,1-o.getDay());return{year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),day:t.getDay()}},calendarMonth(){const o=[];let t;for(let n=0;n<42;n++)t=new Date(this.calendarFirstDay.year,this.calendarFirstDay.month,this.calendarFirstDay.date+n),o.push({year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),day:t.getDay()});return o},formatOrder(){const o={};for(const t of this.orders){const n=Object.keys(t.products)[0],D=t.products[n].product,c=new Date(Number(t.user.address)).setHours(0,0,0,0);o[c]||(o[c]=[]),o[c].push({id:t.id,product:D,user:t.user,message:t.message,time:t.user.address,shownTime:new Date(Number(t.user.address)).getHours(),is_paid:t.is_paid})}return o},bookedTime(){const o=[];for(const t of this.orders)o.push(t.user.address*1);return o}},mounted(){this.isLoading=!0,this.setToday(),this.getBooked(),this.getProducts()}},E={class:"container py-80"},P={class:"calendar text-center"},F={class:"month"},N=a("i",{class:"fas fa-angle-left"},null,-1),S=[N],A={class:"date"},I=a("i",{class:"fas fa-angle-right"},null,-1),Y=[I],J=a("div",{class:"weekDay d-flex"},[a("div",null,"日"),a("div",null,"一"),a("div",null,"二"),a("div",null,"三"),a("div",null,"四"),a("div",null,"五"),a("div",null,"六")],-1),G=["data-date","data-timestamp"],q={class:"d-sm-none"},z={key:0},K=["data-session","onClick"],Q=["data-session","onClick"],W=["data-session","onClick"],X=["data-session","onClick"],Z={key:1},$=["data-session","onClick"],j=["onClick"],ee={class:"d-none d-md-inline"},te={class:"d-none d-sm-inline"},ae={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},se={class:"modal-dialog"},oe={class:"modal-content"},de={class:"modal-header"},le={key:0,class:"modal-title fs-5",id:"orderModalLabel"},re={key:1,class:"modal-title fs-5",id:"orderModalLabel"},ne=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ce={class:"modal-body"},ie={class:"mb-3 row"},ue=a("label",{for:"",class:"col-sm-2 col-form-label"},"類別",-1),he={class:"col-sm-10"},me={class:"form-check form-check-inline"},pe=a("label",{class:"form-check-label",for:"flexRadio1"},"關閉時段",-1),ye={class:"form-check form-check-inline"},_e=a("label",{class:"form-check-label",for:"flexRadio2"},"服務",-1),be={class:"form-check form-check-inline"},ge=a("label",{class:"form-check-label",for:"flexRadio3"},"課程",-1),fe={class:"mb-3 row"},ve=a("label",{for:"",class:"col-sm-2 col-form-label"},null,-1),ke={class:"col-sm-10"},De=["value","selected"],Oe=["value","selected"],we=["value","selected"],Me={class:"mb-3 row"},Te=a("label",{for:"orderTime",class:"col-sm-2 col-form-label"},"時段",-1),xe={class:"col-sm-10"},Ce={class:"mb-3 row"},He=a("label",{for:"userName",class:"col-sm-2 col-form-label"},"名字",-1),Ve={class:"col-sm-10"},Le={class:"mb-3 row"},Re=a("label",{for:"userPhone",class:"col-sm-2 col-form-label"},"電話",-1),Ue={class:"col-sm-10"},Be={class:"mb-3 row"},Ee=a("label",{for:"userEmail",class:"col-sm-2 col-form-label"},"Email",-1),Pe={class:"col-sm-10"},Fe={class:"mb-3 row"},Ne=a("label",{for:"message",class:"col-sm-2 col-form-label"},"備註",-1),Se={class:"col-sm-10"},Ae={class:"mb-3 row"},Ie={class:"form-check col-12"},Ye=a("label",{class:"form-check-label",for:"isPaid"}," 確認付款 ",-1),Je={class:"modal-footer"};function Ge(o,t,n,D,c,s){const x=L("LoaderComponent");return l(),r(m,null,[R(x,{class:O([{"d-none":!c.isLoading},"loader"])},null,8,["class"]),a("div",E,[a("div",P,[a("div",F,[a("button",{class:"btn btn-outline-primary prev",onClick:t[0]||(t[0]=e=>s.adjustMonth(-1))},S),a("div",A,[a("h1",null,h(c.calendar.year),1),a("h2",null,h(c.months[c.calendar.month]),1)]),a("div",{class:"btn btn-outline-primary next",onClick:t[1]||(t[1]=e=>s.adjustMonth(1))},Y)]),J,(l(),r(m,null,y(6,e=>a("div",{class:"week d-flex",key:"aaa"+e},[(l(),r(m,null,y(7,d=>a("div",{class:O(["day text-start ps-1",{other:s.calendarMonth[(e-1)*7+d-1].month!==c.calendar.month,saturday:s.calendarMonth[(e-1)*7+d-1].day==6,sunday:s.calendarMonth[(e-1)*7+d-1].day==0,today:s.calendarMonth[(e-1)*7+d-1].year===c.today.year&&s.calendarMonth[(e-1)*7+d-1].month===c.today.month&&s.calendarMonth[(e-1)*7+d-1].date===c.today.date}]),key:"aaa"+d,"data-date":s.calendarMonth[(e-1)*7+d-1].date,"data-timestamp":this.calculateDate(e,d).valueOf()},[a("p",null,[T(h(s.calendarMonth[(e-1)*7+d-1].date)+" ",1),a("span",q,h(s.calendarMonth[(e-1)*7+d-1].day==0?"(日)":s.calendarMonth[(e-1)*7+d-1].day==1?"(一)":s.calendarMonth[(e-1)*7+d-1].day==2?"(二)":s.calendarMonth[(e-1)*7+d-1].day==3?"(三)":s.calendarMonth[(e-1)*7+d-1].day==4?"(四)":s.calendarMonth[(e-1)*7+d-1].day==5?"(五)":"(六)"),1)]),s.calendarMonth[(e-1)*7+d-1].month==c.calendar.month&&s.calculateDate(e,d).getDay()===6?(l(),r("div",z,[s.calculateDate(e,d)>Date.now()&&s.bookedTime.indexOf(s.calculateDate(e,d).setHours(10,0,0,0))==-1?(l(),r("button",{key:0,type:"button","data-session":s.calculateDate(e,d).setHours(10,0,0,0),class:"btn btn-sm btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:_(f=>this.selectTempOrder(s.calculateDate(e,d).setHours(10,0,0,0),{product:{category:"closed",title:"closed"},time:s.calculateDate(e,d).setHours(10,0,0,0)}),["prevent"])}," 10:00 ",8,K)):p("",!0),s.calculateDate(e,d)>Date.now()&&s.bookedTime.indexOf(s.calculateDate(e,d).setHours(14,0,0,0))==-1?(l(),r("button",{key:1,type:"button","data-session":s.calculateDate(e,d).setHours(14,0,0,0),class:"btn btn-sm btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:_(f=>this.selectTempOrder(s.calculateDate(e,d).setHours(14,0,0,0),{product:{category:"closed",title:"closed"},time:s.calculateDate(e,d).setHours(14,0,0,0)}),["prevent"])}," 14:00 ",8,Q)):p("",!0),s.calculateDate(e,d)>Date.now()&&s.bookedTime.indexOf(s.calculateDate(e,d).setHours(16,0,0,0))==-1?(l(),r("button",{key:2,type:"button","data-session":s.calculateDate(e,d).setHours(16,0,0,0),class:"btn btn-sm btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:_(f=>this.selectTempOrder(s.calculateDate(e,d).setHours(16,0,0,0),{product:{category:"closed",title:"closed"},time:s.calculateDate(e,d).setHours(16,0,0,0)}),["prevent"])}," 16:00 ",8,W)):p("",!0),s.calculateDate(e,d)>Date.now()&&s.bookedTime.indexOf(s.calculateDate(e,d).setHours(20,0,0,0))==-1?(l(),r("button",{key:3,type:"button","data-session":s.calculateDate(e,d).setHours(20,0,0,0),class:"btn btn-sm btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:_(f=>this.selectTempOrder(s.calculateDate(e,d).setHours(20,0,0,0),{product:{category:"closed",title:"closed"},time:s.calculateDate(e,d).setHours(20,0,0,0)}),["prevent"])}," 20:00 ",8,X)):p("",!0)])):s.calendarMonth[(e-1)*7+d-1].month==c.calendar.month&&(s.calculateDate(e,d).getDay()===1||s.calculateDate(e,d).getDay()===2||s.calculateDate(e,d).getDay()===4||s.calculateDate(e,d).getDay()===5)?(l(),r("div",Z,[s.calculateDate(e,d)>Date.now()&&s.bookedTime.indexOf(s.calculateDate(e,d).setHours(20,0,0,0))==-1?(l(),r("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary","data-session":s.calculateDate(e,d).setHours(20,0,0,0),"data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:_(f=>this.selectTempOrder(s.calculateDate(e,d).setHours(20,0,0,0),{product:{category:"closed",title:"closed"},time:s.calculateDate(e,d).setHours(20,0,0,0)}),["prevent"])}," 20:00 ",8,$)):p("",!0)])):p("",!0),(l(!0),r(m,null,y(s.formatOrder,(f,v)=>(l(),r(m,{key:v},[(l(!0),r(m,null,y(s.formatOrder[v],(i,C)=>(l(),r(m,{key:"serve"+C},[v==s.calculateDate(e,d).valueOf()?(l(),r("a",{key:0,href:"#",class:O(["booked d-block",[i.user.name=="closed"&&s.calculateDate(e,d)>Date.now()?"text-muted text-decoration-none":"",s.calculateDate(e,d)>Date.now()?"":"text-danger"]]),"data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:_(qe=>this.selectTempOrder(new Date(parseInt(v)).setHours(i.shownTime,0,0,0),{shownTime:new Date(parseInt(v)).setHours(i.shownTime,0,0,0),time:i.user.address,id:i.id,name:i.user.name,phone:i.user.tel,email:i.user.email,message:i.message,is_paid:i.is_paid,product:{category:i.product.category,title:i.product.title,id:i.product.id}}),["prevent"])},[T(h(i.shownTime+":00")+" ",1),a("span",ee,h(i.user.name),1),a("span",te,h(i.product.title),1)],10,j)):p("",!0)],64))),128))],64))),128))],10,G)),64))])),64))])]),a("div",ae,[a("div",se,[a("div",oe,[a("div",de,[this.tempOrder.id?(l(),r("h1",le,"修改預約")):(l(),r("h1",re,"新增預約/關閉時段")),ne]),a("div",ce,[a("div",ie,[ue,a("div",he,[a("div",me,[u(a("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio1",value:"closed","onUpdate:modelValue":t[2]||(t[2]=e=>this.tempOrder.product.category=e)},null,512),[[w,this.tempOrder.product.category]]),pe]),a("div",ye,[u(a("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio2",value:"service","onUpdate:modelValue":t[3]||(t[3]=e=>this.tempOrder.product.category=e)},null,512),[[w,this.tempOrder.product.category]]),_e]),a("div",be,[u(a("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio3",value:"course","onUpdate:modelValue":t[4]||(t[4]=e=>this.tempOrder.product.category=e)},null,512),[[w,this.tempOrder.product.category]]),ge])])]),a("div",fe,[ve,a("div",ke,[this.tempOrder.product.category=="closed"?u((l(),r("select",{key:0,class:"form-select","onUpdate:modelValue":t[5]||(t[5]=e=>this.tempOrder.product.id=e)},[a("option",{value:c.closed[0].id,selected:this.tempOrder.product.id==c.closed[0].id},"closed",8,De)],512)),[[M,this.tempOrder.product.id]]):this.tempOrder.product.category=="service"?u((l(),r("select",{key:1,class:"form-select","onUpdate:modelValue":t[6]||(t[6]=e=>this.tempOrder.product.id=e)},[(l(!0),r(m,null,y(c.services,e=>(l(),r("option",{value:e.id,key:e.id,selected:this.tempOrder.product.id==e.id},h(e.title),9,Oe))),128))],512)),[[M,this.tempOrder.product.id]]):this.tempOrder.product.category=="course"?u((l(),r("select",{key:2,class:"form-select","onUpdate:modelValue":t[7]||(t[7]=e=>this.tempOrder.product.id=e)},[(l(!0),r(m,null,y(c.courses,e=>(l(),r("option",{value:e.id,key:e.id,selected:this.tempOrder.product.id==e.id},h(e.title),9,we))),128))],512)),[[M,this.tempOrder.product.id]]):p("",!0)])]),a("div",Me,[Te,a("div",xe,[u(a("input",{type:"text",class:"form-control-plaintext",readonly:"",id:"orderTime","onUpdate:modelValue":t[8]||(t[8]=e=>this.tempOrder.shownTime=e)},null,512),[[k,this.tempOrder.shownTime]])])]),a("div",Ce,[He,a("div",Ve,[u(a("input",{type:"text",class:"form-control",id:"userName","onUpdate:modelValue":t[9]||(t[9]=e=>this.tempOrder.name=e)},null,512),[[k,this.tempOrder.name]])])]),a("div",Le,[Re,a("div",Ue,[u(a("input",{type:"tel",class:"form-control",id:"userPhone","onUpdate:modelValue":t[10]||(t[10]=e=>this.tempOrder.phone=e)},null,512),[[k,this.tempOrder.phone]])])]),a("div",Be,[Ee,a("div",Pe,[u(a("input",{type:"email",class:"form-control",id:"userEmail","onUpdate:modelValue":t[11]||(t[11]=e=>this.tempOrder.email=e)},null,512),[[k,this.tempOrder.email]])])]),a("div",Fe,[Ne,a("div",Se,[u(a("input",{type:"text",class:"form-control",id:"message","onUpdate:modelValue":t[12]||(t[12]=e=>this.tempOrder.message=e)},null,512),[[k,this.tempOrder.message]])])]),a("div",Ae,[a("div",Ie,[u(a("input",{class:"form-check-input",type:"checkbox",value:"",id:"isPaid","onUpdate:modelValue":t[13]||(t[13]=e=>this.tempOrder.is_paid=e)},null,512),[[U,this.tempOrder.is_paid]]),Ye])])]),a("div",Je,[this.tempOrder.id?(l(),r("button",{key:0,type:"button",class:"btn btn-outline-danger me-auto","data-bs-dismiss":"modal",onClick:t[14]||(t[14]=e=>s.deleteOrder(this.tempOrder.id))},"刪除預約")):p("",!0),this.tempOrder.id?(l(),r("button",{key:1,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[15]||(t[15]=(...e)=>this.editOrder&&this.editOrder(...e))},"儲存編輯")):(l(),r("button",{key:2,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[16]||(t[16]=(...e)=>this.addToCart&&this.addToCart(...e))},"新增預約"))])])])])],64)}const Qe=V(B,[["render",Ge]]);export{Qe as default};
