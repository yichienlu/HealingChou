import{L as U}from"./LoaderComponent-a19a300c.js";import{_ as E,o as l,c,b as t,k as h,D as k,E as D,F as m,h as _,t as u,j as f,v as b,G as H,M as P,r as C,d as V,n as M,w}from"./index-02c95cdd.js";const{VITE_URL:g,VITE_PATH:v}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"healing_chou",BASE_URL:"/HealingChou/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},B={data(){return{tempOrder:{id:"",products:{product:{}},user:{address:""}}}},props:["order","courses","services","closed"],methods:{addToCart(){const s={product_id:this.tempOrder.products.product.id,qty:1};this.$http.post(`${g}/api/${v}/cart`,{data:s}).then(()=>{this.addOrder()}).catch(e=>{console.log(e)})},addOrder(){const s={user:{name:this.tempOrder.user.name,email:this.tempOrder.user.email,tel:this.tempOrder.user.tel,address:this.tempOrder.user.address.toString()},message:this.tempOrder.message};this.$http.post(`${g}/api/${v}/order`,{data:s}).then(()=>{alert("已成功預約"),this.$emit("get-booked")}).catch(e=>{console.log(e)})},editOrder(s){const e={create_at:this.tempOrder.create_at,id:this.tempOrder.id,is_paid:this.tempOrder.is_paid,products:{[this.tempOrder.products.id]:this.tempOrder.products},total:this.tempOrder.total,user:this.tempOrder.user,num:this.tempOrder.num,message:this.tempOrder.message};this.$http.put(`${g}/api/${v}/admin/order/${s}`,{data:e}).then(()=>{alert("預約資料已修改"),this.$emit("get-booked")}).catch(n=>{console.log(n)})},deleteOrder(s){window.confirm("確定要刪除?")&&this.$http.delete(`${g}/api/${v}/admin/order/${s}`).then(()=>{alert("預約已刪除"),this.$emit("get-booked")}).catch(e=>{console.log(e)})},closeModal(){}},watch:{order(){this.tempOrder=this.order}}},A={class:"modal-dialog"},S={class:"modal-content"},$={class:"modal-header"},F={key:0,class:"modal-title fs-5",id:"orderModalLabel"},I={key:1,class:"modal-title fs-5",id:"orderModalLabel"},N=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},G={class:"mb-3 row"},J=t("legend",{class:"col-form-label col-sm-2 pt-0"},"類別",-1),q={class:"col-sm-10"},z={class:"form-check form-check-inline"},K=t("label",{class:"form-check-label",for:"flexRadio1"},"關閉時段",-1),Q={class:"form-check form-check-inline"},W=t("label",{class:"form-check-label",for:"flexRadio2"},"服務",-1),X={class:"form-check form-check-inline"},Z=t("label",{class:"form-check-label",for:"flexRadio3"},"課程",-1),j={class:"mb-3 row"},ee=t("label",{for:"",class:"col-sm-2 col-form-label"},null,-1),te={class:"col-sm-10"},se=["value","selected"],oe=["value","selected"],ae=["value","selected"],de={class:"mb-3 row"},re=t("label",{for:"orderTime",class:"col-sm-2 col-form-label"},"時段",-1),le={class:"col-sm-10"},ce={class:"mb-3 row"},ne=t("label",{for:"userName",class:"col-sm-2 col-form-label"},"名字",-1),ie={class:"col-sm-10"},ue={class:"mb-3 row"},he=t("label",{for:"userPhone",class:"col-sm-2 col-form-label"},"電話",-1),me={class:"col-sm-10"},pe={class:"mb-3 row"},_e=t("label",{for:"userEmail",class:"col-sm-2 col-form-label"},"Email",-1),ye={class:"col-sm-10"},fe={class:"mb-3 row"},be=t("label",{for:"message",class:"col-sm-2 col-form-label"},"備註",-1),ge={class:"col-sm-10"},ve={class:"mb-3 form-check"},Oe=t("label",{class:"form-check-label",for:"isPaid"}," 確認付款 ",-1),ke={class:"modal-footer"};function De(s,e,n,L,i,a){return l(),c("div",A,[t("div",S,[t("div",$,[this.tempOrder.id?(l(),c("h1",F,"修改預約")):(l(),c("h1",I,"新增預約/關閉時段")),N]),t("div",Y,[t("div",G,[J,t("div",q,[t("div",z,[h(t("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio1",value:"closed","onUpdate:modelValue":e[0]||(e[0]=o=>this.tempOrder.products.product.category=o)},null,512),[[k,this.tempOrder.products.product.category]]),K]),t("div",Q,[h(t("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio2",value:"service","onUpdate:modelValue":e[1]||(e[1]=o=>this.tempOrder.products.product.category=o)},null,512),[[k,this.tempOrder.products.product.category]]),W]),t("div",X,[h(t("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio3",value:"course","onUpdate:modelValue":e[2]||(e[2]=o=>this.tempOrder.products.product.category=o)},null,512),[[k,this.tempOrder.products.product.category]]),Z])])]),t("div",j,[ee,t("div",te,[this.tempOrder.products.product.category=="closed"?h((l(),c("select",{key:0,class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>this.tempOrder.products.product.id=o)},[t("option",{value:n.closed[0].id,selected:this.tempOrder.products.product.id==n.closed[0].id},"closed",8,se)],512)),[[D,this.tempOrder.products.product.id]]):this.tempOrder.products.product.category=="service"?h((l(),c("select",{key:1,class:"form-select","onUpdate:modelValue":e[4]||(e[4]=o=>this.tempOrder.products.product.id=o)},[(l(!0),c(m,null,_(n.services,o=>(l(),c("option",{value:o.id,key:o.id,selected:this.tempOrder.products.product.id==o.id},u(o.title),9,oe))),128))],512)),[[D,this.tempOrder.products.product.id]]):this.tempOrder.products.product.category=="course"?h((l(),c("select",{key:2,class:"form-select","onUpdate:modelValue":e[5]||(e[5]=o=>this.tempOrder.products.product.id=o)},[(l(!0),c(m,null,_(n.courses,o=>(l(),c("option",{value:o.id,key:o.id,selected:this.tempOrder.products.product.id==o.id},u(o.title),9,ae))),128))],512)),[[D,this.tempOrder.products.product.id]]):f("",!0)])]),t("div",de,[re,t("div",le,u(new Date(+this.tempOrder.user.address).toLocaleDateString())+" ("+u(["日","一","二","三","四","五","六"][new Date(+this.tempOrder.user.address).getDay()])+") "+u(new Date(+this.tempOrder.user.address).toLocaleTimeString()),1)]),t("div",ce,[ne,t("div",ie,[h(t("input",{type:"text",class:"form-control",id:"userName","onUpdate:modelValue":e[6]||(e[6]=o=>this.tempOrder.user.name=o)},null,512),[[b,this.tempOrder.user.name]])])]),t("div",ue,[he,t("div",me,[h(t("input",{type:"tel",class:"form-control",id:"userPhone","onUpdate:modelValue":e[7]||(e[7]=o=>this.tempOrder.user.tel=o)},null,512),[[b,this.tempOrder.user.tel]])])]),t("div",pe,[_e,t("div",ye,[h(t("input",{type:"email",class:"form-control",id:"userEmail","onUpdate:modelValue":e[8]||(e[8]=o=>this.tempOrder.user.email=o)},null,512),[[b,this.tempOrder.user.email]])])]),t("div",fe,[be,t("div",ge,[h(t("input",{type:"text",class:"form-control",id:"message","onUpdate:modelValue":e[9]||(e[9]=o=>this.tempOrder.message=o)},null,512),[[b,this.tempOrder.message]])])]),t("div",ve,[h(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"isPaid","onUpdate:modelValue":e[10]||(e[10]=o=>this.tempOrder.is_paid=o)},null,512),[[H,this.tempOrder.is_paid]]),Oe])]),t("div",ke,[this.tempOrder.id?(l(),c("button",{key:0,type:"button",class:"btn btn-outline-danger me-auto","data-bs-dismiss":"modal",onClick:e[11]||(e[11]=o=>a.deleteOrder(this.tempOrder.id))},"刪除預約")):f("",!0),this.tempOrder.id?(l(),c("button",{key:1,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[12]||(e[12]=o=>this.editOrder(this.tempOrder.id))},"儲存編輯")):(l(),c("button",{key:2,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[13]||(e[13]=(...o)=>this.addToCart&&this.addToCart(...o))},"新增預約"))])])])}const Me=E(B,[["render",De]]),{VITE_URL:x,VITE_PATH:T}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"healing_chou",BASE_URL:"/HealingChou/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},we={data(){return{isLoading:!1,months:["January","February","March","April","May","June","July","August","September","October","November","December"],orders:[],tempOrder:{id:"",products:{product:{}},user:{address:""}},today:{year:0,month:0,date:0,day:0},calendar:{year:0,month:0,date:0,day:0},courses:[],services:[],closed:[],total_pages:0,orderModal:null}},components:{LoaderComponent:U,AdminOrdersComponent:Me},methods:{getBooked(){this.$http.get(`${x}/api/${T}/admin/orders`).then(s=>{this.total_pages=s.data.pagination.total_pages,this.processBooked()}).catch(s=>{console.log(s)})},async processBooked(){for(let s=1;s<=this.total_pages;s++)await this.getBookedPages(s);this.orders=this.orders.sort((s,e)=>s.user.address-e.user.address),setTimeout(()=>{this.isLoading=!1},1e3)},getBookedPages(s){return new Promise(e=>{this.$http.get(`${x}/api/${T}/admin/orders?page=${s}`).then(n=>{s==1?this.orders=n.data.orders:this.orders=this.orders.concat(n.data.orders),e()}).catch(n=>{console.log(n)})})},selectTempOrder(s){this.tempOrder=s,this.orderModal.show()},setToday(){const s=new Date;this.today.year=this.calendar.year=s.getFullYear(),this.today.month=this.calendar.month=s.getMonth(),this.today.date=this.calendar.date=s.getDate(),this.today.day=this.calendar.day=s.getDay()},adjustYear(s){this.calendar.year+=s},adjustMonth(s){let e=this.calendar.month+s;e>11?(this.adjustYear(1),this.calendar.month=0):e<0?(this.adjustYear(-1),this.calendar.month=11):this.calendar.month=e},calculateDate(s,e){return new Date(this.calendarMonth[(s-1)*7+e-1].year,this.calendarMonth[(s-1)*7+e-1].month,this.calendarMonth[(s-1)*7+e-1].date)},getProducts(){this.$http.get(`${x}/api/${T}/products/all`).then(s=>{s.data.products.forEach(e=>{e.category=="course"?this.courses.push({title:e.title,id:e.id}):e.category=="service"?this.services.push({title:e.title,id:e.id}):this.closed.push({title:e.title,id:e.id})})}).catch(s=>{console.log(s)})}},computed:{calendarFirstDay(){const s=new Date(this.calendar.year,this.calendar.month,1),e=new Date(this.calendar.year,this.calendar.month,1-s.getDay());return{year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay()}},calendarMonth(){const s=[];let e;for(let n=0;n<42;n++)e=new Date(this.calendarFirstDay.year,this.calendarFirstDay.month,this.calendarFirstDay.date+n),s.push({year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay()});return s},formatOrder(){const s={};for(const e of this.orders){const n=new Date(Number(e.user.address)).setHours(0,0,0,0);s[n]||(s[n]=[]),s[n].push({create_at:e.create_at,id:e.id,is_paid:e.is_paid,products:Object.values(e.products)[0],total:e.total,user:e.user,message:e.message,num:e.num})}return s},bookedTime(){const s=[];for(const e of this.orders)s.push(e.user.address*1);return s}},mounted(){this.isLoading=!0,this.setToday(),this.getBooked(),this.getProducts(),this.orderModal=new P("#orderModal")}},xe={class:"container py-80"},Te={class:"calendar text-center"},Ce={class:"month d-flex justify-content-between align-items-center text-center px-3"},Ve=t("i",{class:"fas fa-angle-left poiner"},null,-1),Ee=[Ve],Le={class:"date"},Re=t("i",{class:"fas fa-angle-right pointer"},null,-1),Ue=[Re],He=t("div",{class:"weekDay d-flex"},[t("div",null,"日"),t("div",null,"一"),t("div",null,"二"),t("div",null,"三"),t("div",null,"四"),t("div",null,"五"),t("div",null,"六")],-1),Pe=["data-date","data-timestamp"],Be={key:0},Ae=["data-session","onClick"],Se={key:1},$e=["data-session","onClick"],Fe=["onClick"],Ie={class:"d-none d-md-block"},Ne={class:"d-none d-sm-block"},Ye={class:"modal fade",id:"orderModal",ref:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"};function Ge(s,e,n,L,i,a){const o=C("LoaderComponent"),R=C("AdminOrdersComponent");return l(),c(m,null,[V(o,{class:M([{"d-none":!i.isLoading},"loader"])},null,8,["class"]),t("div",xe,[t("div",Te,[t("div",Ce,[t("button",{type:"button",class:"btn btn-outline-primary prev",onClick:e[0]||(e[0]=d=>a.adjustMonth(-1))},Ee),t("div",Le,[t("h1",null,u(i.calendar.year),1),t("h2",null,u(i.months[i.calendar.month]),1)]),t("div",{class:"btn btn-outline-primary next",onClick:e[1]||(e[1]=d=>a.adjustMonth(1))},Ue)]),He,(l(),c(m,null,_(6,d=>t("div",{class:"week d-flex",key:"aaa"+d},[(l(),c(m,null,_(7,r=>t("div",{class:M(["day text-start ps-1",{other:a.calendarMonth[(d-1)*7+r-1].month!==i.calendar.month,saturday:a.calendarMonth[(d-1)*7+r-1].day==6,sunday:a.calendarMonth[(d-1)*7+r-1].day==0,today:a.calendarMonth[(d-1)*7+r-1].year===i.today.year&&a.calendarMonth[(d-1)*7+r-1].month===i.today.month&&a.calendarMonth[(d-1)*7+r-1].date===i.today.date}]),key:"aaa"+r,"data-date":a.calendarMonth[(d-1)*7+r-1].date,"data-timestamp":this.calculateDate(d,r).valueOf()},[t("p",null,u(a.calendarMonth[(d-1)*7+r-1].date),1),a.calendarMonth[(d-1)*7+r-1].month==i.calendar.month&&a.calculateDate(d,r).getDay()===6?(l(),c("div",Be,[(l(),c(m,null,_([10,14,16,20],p=>(l(),c(m,{key:a.calculateDate(d,r).setHours(p,0,0,0)},[a.calculateDate(d,r)>Date.now()&&a.bookedTime.indexOf(a.calculateDate(d,r).setHours(p,0,0,0))==-1?(l(),c("button",{key:0,type:"button","data-session":a.calculateDate(d,r).setHours(p,0,0,0),class:"btn btn-sm btn-outline-primary",onClick:w(O=>this.selectTempOrder({products:{product:{category:"closed",title:"closed"}},user:{address:a.calculateDate(d,r).setHours(p,0,0,0)}}),["prevent"])},u(p)+":00 ",9,Ae)):f("",!0)],64))),64))])):a.calendarMonth[(d-1)*7+r-1].month==i.calendar.month&&(a.calculateDate(d,r).getDay()===1||a.calculateDate(d,r).getDay()===2||a.calculateDate(d,r).getDay()===4||a.calculateDate(d,r).getDay()===5)?(l(),c("div",Se,[a.calculateDate(d,r)>Date.now()&&a.bookedTime.indexOf(a.calculateDate(d,r).setHours(20,0,0,0))==-1?(l(),c("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary","data-session":a.calculateDate(d,r).setHours(20,0,0,0),onClick:w(p=>this.selectTempOrder({products:{product:{category:"closed",title:"closed"}},user:{address:a.calculateDate(d,r).setHours(20,0,0,0)}}),["prevent"])}," 20:00 ",8,$e)):f("",!0)])):f("",!0),(l(!0),c(m,null,_(a.formatOrder,(p,O)=>(l(),c(m,{key:O},[a.calculateDate(d,r).valueOf()==O?(l(!0),c(m,{key:0},_(p,y=>(l(),c("a",{key:y.id,href:"#",class:M(["booked d-block d-flex pointer",[y.user.name=="closed"&&a.calculateDate(d,r)>Date.now()?"text-muted text-decoration-none":"",a.calculateDate(d,r)>Date.now()?"":"text-danger"]]),onClick:w(Je=>this.selectTempOrder(y),["prevent"])},[t("span",Ie,u(new Date(Number(y.user.address)).getHours())+":00 ",1),t("span",Ne,u(y.user.name),1),t("span",null,u(y.products.product.title),1)],10,Fe))),128)):f("",!0)],64))),128))],10,Pe)),64))])),64))])]),t("div",Ye,[V(R,{order:i.tempOrder,courses:i.courses,services:i.services,closed:i.closed,onGetBooked:a.getBooked},null,8,["order","courses","services","closed","onGetBooked"])],512)],64)}const Ke=E(we,[["render",Ge]]);export{Ke as default};
