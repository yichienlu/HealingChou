import{L as x}from"./LoaderComponent-c729b032.js";import{_ as C,M as T,r as V,o as r,c as l,d as L,n as O,b as t,t as i,F as h,h as p,k as u,D as k,E as D,j as b,v as g,G as R,w as M,f as U}from"./index-64541ee2.js";const{VITE_URL:_,VITE_PATH:y}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"healing_chou",BASE_URL:"/HealingChou/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},B={data(){return{isLoading:!1,months:["January","February","March","April","May","June","July","August","September","October","November","December"],orders:[],tempOrder:{id:"",products:{product:{}},user:{address:""}},today:{year:0,month:0,date:0,day:0},calendar:{year:0,month:0,date:0,day:0},courses:[],services:[],closed:[],total_pages:0,orderModal:null}},components:{LoaderComponent:x},methods:{getBooked(){this.$http.get(`${_}/api/${y}/admin/orders`).then(a=>{this.total_pages=a.data.pagination.total_pages,this.processBooked()}).catch(a=>{console.log(a)})},async processBooked(){for(let a=1;a<=this.total_pages;a++)await this.getBookedPages(a);this.orders=this.orders.sort((a,e)=>a.user.address-e.user.address),setTimeout(()=>{this.isLoading=!1},1e3)},getBookedPages(a){return new Promise(e=>{this.$http.get(`${_}/api/${y}/admin/orders?page=${a}`).then(c=>{a==1?this.orders=c.data.orders:this.orders=this.orders.concat(c.data.orders),e()}).catch(c=>{console.log(c)})})},selectTempOrder(a){this.tempOrder=a,this.orderModal.show()},setToday(){const a=new Date;this.today.year=this.calendar.year=a.getFullYear(),this.today.month=this.calendar.month=a.getMonth(),this.today.date=this.calendar.date=a.getDate(),this.today.day=this.calendar.day=a.getDay()},adjustYear(a){this.calendar.year+=a},adjustMonth(a){let e=this.calendar.month+a;e>11?(this.adjustYear(1),this.calendar.month=0):e<0?(this.adjustYear(-1),this.calendar.month=11):this.calendar.month=e},calculateDate(a,e){return new Date(this.calendarMonth[(a-1)*7+e-1].year,this.calendarMonth[(a-1)*7+e-1].month,this.calendarMonth[(a-1)*7+e-1].date)},getProducts(){this.$http.get(`${_}/api/${y}/products/all`).then(a=>{a.data.products.forEach(e=>{e.category=="course"?this.courses.push({title:e.title,id:e.id}):e.category=="service"?this.services.push({title:e.title,id:e.id}):this.closed.push({title:e.title,id:e.id})})}).catch(a=>{console.log(a)})},addToCart(){const a={product_id:this.tempOrder.products.product.id,qty:1};this.$http.post(`${_}/api/${y}/cart`,{data:a}).then(()=>{this.addOrder()}).catch(e=>{console.log(e)})},addOrder(){const a={user:{name:this.tempOrder.user.name,email:this.tempOrder.user.email,tel:this.tempOrder.user.tel,address:this.tempOrder.user.address.toString()},message:this.tempOrder.message};this.$http.post(`${_}/api/${y}/order`,{data:a}).then(()=>{alert("已成功預約"),this.getBooked()}).catch(e=>{console.log(e)})},editOrder(a){const e={create_at:this.tempOrder.create_at,id:this.tempOrder.id,is_paid:this.tempOrder.is_paid,products:{[this.tempOrder.products.id]:this.tempOrder.products},total:this.tempOrder.total,user:this.tempOrder.user,num:this.tempOrder.num};this.$http.put(`${_}/api/${y}/admin/order/${a}`,{data:e}).then(()=>{alert("預約資料已修改"),this.getBooked()}).catch(c=>{console.log(c)})},deleteOrder(a){window.confirm("確定要刪除?")&&this.$http.delete(`${_}/api/${y}/admin/order/${a}`).then(()=>{alert("預約已刪除"),this.isLoading=!0,this.getBooked()}).catch(e=>{console.log(e)})}},computed:{calendarFirstDay(){const a=new Date(this.calendar.year,this.calendar.month,1),e=new Date(this.calendar.year,this.calendar.month,1-a.getDay());return{year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay()}},calendarMonth(){const a=[];let e;for(let c=0;c<42;c++)e=new Date(this.calendarFirstDay.year,this.calendarFirstDay.month,this.calendarFirstDay.date+c),a.push({year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay()});return a},formatOrder(){const a={};for(const e of this.orders){const c=new Date(Number(e.user.address)).setHours(0,0,0,0);a[c]||(a[c]=[]),a[c].push({create_at:e.create_at,id:e.id,is_paid:e.is_paid,products:Object.values(e.products)[0],total:e.total,user:e.user,message:e.message,num:e.num})}return a},bookedTime(){const a=[];for(const e of this.orders)a.push(e.user.address*1);return a}},mounted(){this.isLoading=!0,this.setToday(),this.getBooked(),this.getProducts(),this.orderModal=new T("#orderModal")}},E={class:"container py-80"},H={class:"calendar text-center"},P={class:"month"},F=t("i",{class:"fas fa-angle-left poiner"},null,-1),N=[F],S={class:"date"},A=t("i",{class:"fas fa-angle-right pointer"},null,-1),Y=[A],I=t("div",{class:"weekDay d-flex"},[t("div",null,"日"),t("div",null,"一"),t("div",null,"二"),t("div",null,"三"),t("div",null,"四"),t("div",null,"五"),t("div",null,"六")],-1),J=["data-date","data-timestamp"],q={key:0},z=["data-session","onClick"],G={key:1},K=["data-session","onClick"],Q=["onClick"],W={class:"d-none d-md-block"},X={class:"d-none d-sm-block"},Z={class:"modal fade",id:"orderModal",ref:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},$={class:"modal-dialog"},j={class:"modal-content"},ee={class:"modal-header"},te={key:0,class:"modal-title fs-5",id:"orderModalLabel"},se={key:1,class:"modal-title fs-5",id:"orderModalLabel"},ae=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),de={class:"modal-body"},oe={class:"mb-3 row"},re=t("legend",{class:"col-form-label col-sm-2 pt-0"},"類別",-1),le={class:"col-sm-10"},ce={class:"form-check form-check-inline"},ne=t("label",{class:"form-check-label",for:"flexRadio1"},"關閉時段",-1),ie={class:"form-check form-check-inline"},ue=t("label",{class:"form-check-label",for:"flexRadio2"},"服務",-1),he={class:"form-check form-check-inline"},me=t("label",{class:"form-check-label",for:"flexRadio3"},"課程",-1),pe={class:"mb-3 row"},_e=t("label",{for:"",class:"col-sm-2 col-form-label"},null,-1),ye={class:"col-sm-10"},fe=["value","selected"],be=["value","selected"],ge=["value","selected"],ve={class:"mb-3 row"},Oe=t("label",{for:"orderTime",class:"col-sm-2 col-form-label"},"時段",-1),ke={class:"col-sm-10"},De={class:"mb-3 row"},Me=t("label",{for:"userName",class:"col-sm-2 col-form-label"},"名字",-1),we={class:"col-sm-10"},xe={class:"mb-3 row"},Ce=t("label",{for:"userPhone",class:"col-sm-2 col-form-label"},"電話",-1),Te={class:"col-sm-10"},Ve={class:"mb-3 row"},Le=t("label",{for:"userEmail",class:"col-sm-2 col-form-label"},"Email",-1),Re={class:"col-sm-10"},Ue={class:"mb-3 row"},Be=t("label",{for:"message",class:"col-sm-2 col-form-label"},"備註",-1),Ee={class:"col-sm-10"},He={class:"mb-3 form-check"},Pe=t("label",{class:"form-check-label",for:"isPaid"}," 確認付款 ",-1),Fe={class:"modal-footer"};function Ne(a,e,c,Se,n,d){const w=V("LoaderComponent");return r(),l(h,null,[L(w,{class:O([{"d-none":!n.isLoading},"loader"])},null,8,["class"]),t("div",E,[t("div",H,[t("div",P,[t("button",{type:"button",class:"btn btn-outline-primary prev",onClick:e[0]||(e[0]=s=>d.adjustMonth(-1))},N),t("div",S,[t("h1",null,i(n.calendar.year),1),t("h2",null,i(n.months[n.calendar.month]),1)]),t("div",{class:"btn btn-outline-primary next",onClick:e[1]||(e[1]=s=>d.adjustMonth(1))},Y)]),I,(r(),l(h,null,p(6,s=>t("div",{class:"week d-flex",key:"aaa"+s},[(r(),l(h,null,p(7,o=>t("div",{class:O(["day text-start ps-1",{other:d.calendarMonth[(s-1)*7+o-1].month!==n.calendar.month,saturday:d.calendarMonth[(s-1)*7+o-1].day==6,sunday:d.calendarMonth[(s-1)*7+o-1].day==0,today:d.calendarMonth[(s-1)*7+o-1].year===n.today.year&&d.calendarMonth[(s-1)*7+o-1].month===n.today.month&&d.calendarMonth[(s-1)*7+o-1].date===n.today.date}]),key:"aaa"+o,"data-date":d.calendarMonth[(s-1)*7+o-1].date,"data-timestamp":this.calculateDate(s,o).valueOf()},[t("p",null,i(d.calendarMonth[(s-1)*7+o-1].date),1),d.calendarMonth[(s-1)*7+o-1].month==n.calendar.month&&d.calculateDate(s,o).getDay()===6?(r(),l("div",q,[(r(),l(h,null,p([10,14,16,20],m=>(r(),l(h,{key:d.calculateDate(s,o).setHours(m,0,0,0)},[d.calculateDate(s,o)>Date.now()&&d.bookedTime.indexOf(d.calculateDate(s,o).setHours(m,0,0,0))==-1?(r(),l("button",{key:0,type:"button","data-session":d.calculateDate(s,o).setHours(m,0,0,0),class:"btn btn-sm btn-outline-primary",onClick:M(v=>this.selectTempOrder({products:{product:{category:"closed",title:"closed"}},user:{address:d.calculateDate(s,o).setHours(m,0,0,0)}}),["prevent"])},i(m)+":00 ",9,z)):b("",!0)],64))),64))])):d.calendarMonth[(s-1)*7+o-1].month==n.calendar.month&&(d.calculateDate(s,o).getDay()===1||d.calculateDate(s,o).getDay()===2||d.calculateDate(s,o).getDay()===4||d.calculateDate(s,o).getDay()===5)?(r(),l("div",G,[d.calculateDate(s,o)>Date.now()&&d.bookedTime.indexOf(d.calculateDate(s,o).setHours(20,0,0,0))==-1?(r(),l("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary","data-session":d.calculateDate(s,o).setHours(20,0,0,0),onClick:M(m=>this.selectTempOrder({products:{product:{category:"closed",title:"closed"}},user:{address:d.calculateDate(s,o).setHours(20,0,0,0)}}),["prevent"])}," 20:00 ",8,K)):b("",!0)])):b("",!0),(r(!0),l(h,null,p(d.formatOrder,(m,v)=>(r(),l(h,{key:v},[d.calculateDate(s,o).valueOf()==v?(r(!0),l(h,{key:0},p(m,f=>(r(),l("a",{key:f.id,href:"#",class:O(["booked d-block pointer",[f.user.name=="closed"&&d.calculateDate(s,o)>Date.now()?"text-muted text-decoration-none":"",d.calculateDate(s,o)>Date.now()?"":"text-danger"]]),onClick:M(Ae=>this.selectTempOrder(f),["prevent"])},[t("span",W,i(new Date(Number(f.user.address)).getHours())+":00",1),t("span",X,i(f.user.name),1),U(" "+i(f.products.product.title),1)],10,Q))),128)):b("",!0)],64))),128))],10,J)),64))])),64))])]),t("div",Z,[t("div",$,[t("div",j,[t("div",ee,[this.tempOrder.id?(r(),l("h1",te,"修改預約")):(r(),l("h1",se,"新增預約/關閉時段")),ae]),t("div",de,[t("div",oe,[re,t("div",le,[t("div",ce,[u(t("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio1",value:"closed","onUpdate:modelValue":e[2]||(e[2]=s=>this.tempOrder.products.product.category=s)},null,512),[[k,this.tempOrder.products.product.category]]),ne]),t("div",ie,[u(t("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio2",value:"service","onUpdate:modelValue":e[3]||(e[3]=s=>this.tempOrder.products.product.category=s)},null,512),[[k,this.tempOrder.products.product.category]]),ue]),t("div",he,[u(t("input",{class:"form-check-input",type:"radio",name:"flexRadio",id:"flexRadio3",value:"course","onUpdate:modelValue":e[4]||(e[4]=s=>this.tempOrder.products.product.category=s)},null,512),[[k,this.tempOrder.products.product.category]]),me])])]),t("div",pe,[_e,t("div",ye,[this.tempOrder.products.product.category=="closed"?u((r(),l("select",{key:0,class:"form-select","onUpdate:modelValue":e[5]||(e[5]=s=>this.tempOrder.products.product.id=s)},[t("option",{value:n.closed[0].id,selected:this.tempOrder.products.product.id==n.closed[0].id},"closed",8,fe)],512)),[[D,this.tempOrder.products.product.id]]):this.tempOrder.products.product.category=="service"?u((r(),l("select",{key:1,class:"form-select","onUpdate:modelValue":e[6]||(e[6]=s=>this.tempOrder.products.product.id=s)},[(r(!0),l(h,null,p(n.services,s=>(r(),l("option",{value:s.id,key:s.id,selected:this.tempOrder.products.product.id==s.id},i(s.title),9,be))),128))],512)),[[D,this.tempOrder.products.product.id]]):this.tempOrder.products.product.category=="course"?u((r(),l("select",{key:2,class:"form-select","onUpdate:modelValue":e[7]||(e[7]=s=>this.tempOrder.products.product.id=s)},[(r(!0),l(h,null,p(n.courses,s=>(r(),l("option",{value:s.id,key:s.id,selected:this.tempOrder.products.product.id==s.id},i(s.title),9,ge))),128))],512)),[[D,this.tempOrder.products.product.id]]):b("",!0)])]),t("div",ve,[Oe,t("div",ke,i(new Date(+this.tempOrder.user.address).toLocaleDateString())+" ("+i(["日","一","二","三","四","五","六"][new Date(+this.tempOrder.user.address).getDay()])+") "+i(new Date(+this.tempOrder.user.address).toLocaleTimeString()),1)]),t("div",De,[Me,t("div",we,[u(t("input",{type:"text",class:"form-control",id:"userName","onUpdate:modelValue":e[8]||(e[8]=s=>this.tempOrder.user.name=s)},null,512),[[g,this.tempOrder.user.name]])])]),t("div",xe,[Ce,t("div",Te,[u(t("input",{type:"tel",class:"form-control",id:"userPhone","onUpdate:modelValue":e[9]||(e[9]=s=>this.tempOrder.user.tel=s)},null,512),[[g,this.tempOrder.user.tel]])])]),t("div",Ve,[Le,t("div",Re,[u(t("input",{type:"email",class:"form-control",id:"userEmail","onUpdate:modelValue":e[10]||(e[10]=s=>this.tempOrder.user.email=s)},null,512),[[g,this.tempOrder.user.email]])])]),t("div",Ue,[Be,t("div",Ee,[u(t("input",{type:"text",class:"form-control",id:"message","onUpdate:modelValue":e[11]||(e[11]=s=>this.tempOrder.message=s)},null,512),[[g,this.tempOrder.message]])])]),t("div",He,[u(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"isPaid","onUpdate:modelValue":e[12]||(e[12]=s=>this.tempOrder.is_paid=s)},null,512),[[R,this.tempOrder.is_paid]]),Pe])]),t("div",Fe,[this.tempOrder.id?(r(),l("button",{key:0,type:"button",class:"btn btn-outline-danger me-auto","data-bs-dismiss":"modal",onClick:e[13]||(e[13]=s=>d.deleteOrder(this.tempOrder.id))},"刪除預約")):b("",!0),this.tempOrder.id?(r(),l("button",{key:1,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[14]||(e[14]=s=>this.editOrder(this.tempOrder.id))},"儲存編輯")):(r(),l("button",{key:2,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[15]||(e[15]=(...s)=>this.addToCart&&this.addToCart(...s))},"新增預約"))])])])],512)],64)}const Je=C(B,[["render",Ne]]);export{Je as default};
