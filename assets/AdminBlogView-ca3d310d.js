import{E as M,t as U}from"./Editor-e4579d7c.js";import{_ as k,r as A,o as s,c as n,b as t,k as c,l as m,d as f,G as V,F as y,h as x,M as E,t as b}from"./index-3f6724fd.js";import{P as $}from"./PaginationComponent-7ab2faf9.js";const{VITE_URL:w,VITE_PATH:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"healing_chou",BASE_URL:"/HealingChou/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},T={data(){return{tempArticle:{},create_at:0,init:{language:"zh_TW",height:500,menubar:!1,content_css:!1,skin:!1,plugins:this.plugins,toolbar:this.toolbar,quickbars_insert_toolbar:!1,branding:!1}}},components:{Editor:M},props:{articleModal:{},article:{},value:{type:String,default:""},plugins:{type:[String,Array],default:"quickbars emoticons table"},toolbar:{type:[String,Array],default:" bold italic underline strikethrough | fontsizeselect | forecolor backcolor | alignleft aligncenter alignright alignjustify|bullist numlist |outdent indent blockquote | undo redo | axupimgs | removeformat | emoticons |table"}},watch:{article(){this.tempArticle=this.article;var i=new Date(this.tempArticle.create_at*1e3);this.create_at=`${i.getFullYear()}-${i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1}-${i.getDate()<10?"0"+i.getDate():i.getDate()}`},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},methods:{uploadImage(){const e=document.querySelector("#imageUpload").files[0],r=new FormData;r.append("file-to-upload",e),this.$http.post(`${w}/api/${C}/admin/upload`,r).then(p=>{this.tempArticle.imageUrl=p.data.imageUrl}).catch(p=>{console.log(p.response)})}},mounted(){U.init({})}},P={class:"modal-dialog modal-xl",role:"document"},D={class:"modal-content border-0"},I={class:"modal-header bg-dark text-white"},R={class:"modal-title",id:"exampleModalLabel"},S={key:0},L={key:1},B=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},q={class:"row"},F={class:"col-sm-8"},O={class:"mb-3"},z=t("label",{for:"title",class:"form-label"},"標題",-1),N={class:"row"},j={class:"col"},G={class:"mb-3"},W=t("label",{for:"author",class:"form-label"},"分類",-1),X={class:"col"},Y={class:"mb-3"},J=t("label",{for:"create_at",class:"form-label"},"文章建立日期",-1),K={class:"mb-3"},Q=t("label",{for:"description",class:"form-label"},"文章描述",-1),Z={class:"mb-3"},tt=t("label",{for:"content",class:"form-label"},"文章內容",-1),et={class:"mb-3"},lt={class:"form-check"},ot=t("label",{class:"form-check-label",for:"isPublic"}," 是否公開 ",-1),it={class:"col-sm-4"},st={class:"mb-3"},nt=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),at={enctype:"multipart/form-data",method:"post"},ct=["src"],rt=t("label",{for:"tag",class:"form-label"},"標籤",-1),dt={class:"row gx-1 mb-3"},mt={class:"input-group input-group-sm"},pt=["onUpdate:modelValue"],ut=["onClick"],ht={class:"col-md-2 mb-1"},_t=["disabled"],bt={class:"modal-footer"};function gt(i,e,r,p,l,a){var _;const g=A("editor");return s(),n("div",P,[t("div",D,[t("div",I,[t("h5",R,[l.tempArticle.id?(s(),n("span",S,"編輯貼文")):(s(),n("span",L,"新增貼文"))]),B]),t("div",H,[t("div",q,[t("div",F,[t("div",O,[z,c(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=o=>l.tempArticle.title=o),placeholder:"請輸入標題"},null,512),[[m,l.tempArticle.title]])]),t("div",N,[t("div",j,[t("div",G,[W,c(t("input",{type:"text",class:"form-control",id:"author","onUpdate:modelValue":e[1]||(e[1]=o=>l.tempArticle.author=o),placeholder:"請輸入標題"},null,512),[[m,l.tempArticle.author]])])]),t("div",X,[t("div",Y,[J,c(t("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":e[2]||(e[2]=o=>this.create_at=o)},null,512),[[m,this.create_at]])])])]),t("div",K,[Q,c(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[3]||(e[3]=o=>l.tempArticle.description=o),placeholder:"請輸入文章描述"},null,512),[[m,l.tempArticle.description]])]),t("div",Z,[tt,f(g,{modelValue:l.tempArticle.content,"onUpdate:modelValue":e[4]||(e[4]=o=>l.tempArticle.content=o),init:l.init},null,8,["modelValue","init"])]),t("div",et,[t("div",lt,[c(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=o=>l.tempArticle.isPublic=o),id:"isPublic"},null,512),[[V,l.tempArticle.isPublic]]),ot])])]),t("div",it,[t("div",st,[nt,c(t("input",{type:"text",class:"form-control",id:"imageUrl","onUpdate:modelValue":e[6]||(e[6]=o=>l.tempArticle.imageUrl=o),placeholder:"請輸入圖片連結"},null,512),[[m,l.tempArticle.imageUrl]]),t("form",at,[t("input",{type:"file",name:"file-to-upload",id:"imageUpload",ref:"file",placeholder:"請選擇圖片",onChange:e[7]||(e[7]=o=>a.uploadImage()),class:"form-control"},null,544)]),t("img",{class:"img-fluid",src:l.tempArticle.imageUrl,alt:"文章圖片"},null,8,ct)]),rt,t("div",dt,[(s(!0),n(y,null,x(l.tempArticle.tag,(o,d)=>(s(),n("div",{class:"col-md-2 mb-1",key:d},[t("div",mt,[c(t("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":v=>l.tempArticle.tag[d]=v,placeholder:"請輸入標籤"},null,8,pt),[[m,l.tempArticle.tag[d]]]),t("button",{type:"button",class:"btn btn-danger",onClick:v=>l.tempArticle.tag.splice(d,1)}," X ",8,ut)])]))),128)),t("div",ht,[l.tempArticle.tag?(s(),n("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:e[8]||(e[8]=o=>l.tempArticle.tag.push("")),disabled:l.tempArticle.tag[((_=l.tempArticle.tag)==null?void 0:_.length)-1]==""}," 新增標籤 ",8,_t)):(s(),n("button",{key:1,class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:e[9]||(e[9]=o=>l.tempArticle.tag=[""])}," 新增標籤 "))])])])])]),t("div",bt,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:e[10]||(e[10]=o=>l.tempArticle={content:""})}," 取消 "),l.tempArticle.id?(s(),n("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=o=>this.$emit("editArticle",r.article))}," 確認編輯 ")):(s(),n("button",{key:1,type:"button",class:"btn btn-primary",onClick:e[12]||(e[12]=o=>this.$emit("addArticle",r.article))}," 確認新增 "))])])])}const At=k(T,[["render",gt]]),{VITE_URL:u,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"healing_chou",BASE_URL:"/HealingChou/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ft={data(){return{tempArticle:{},articles:[],pagination:{},articleModal:null}},components:{Pagination:$,AdminBlogModal:At},methods:{getAdminArticles(i=1){this.$http.get(`${u}/api/${h}/admin/articles?page=${i}`).then(e=>{this.articles=e.data.articles,this.pagination=e.data.pagination}).catch(e=>{console.log(e)})},addArticle(i){this.$http.post(`${u}/api/${h}/admin/article`,{data:i}).then(e=>{alert(e.data.message),this.articleModal.hide(),this.tempArticle={content:""},this.getAdminArticles()}).catch(e=>{console.log(e)})},editArticle(i){this.$http.put(`${u}/api/${h}/admin/article/${this.tempArticle.id}`,{data:i}).then(e=>{alert(e.data.message),this.articleModal.hide(),this.tempArticle={content:""},this.getAdminArticles()}).catch(e=>{console.log(e)})},deleteArticle(i){window.confirm("確定要刪除?")&&this.$http.delete(`${u}/api/${h}/admin/article/${i}`).then(e=>{alert(e.data.message),this.getAdminArticles()}).catch(e=>{console.log(e)})},selectTempArticle(i){i.id?this.$http.get(`${u}/api/${h}/admin/article/${i.id}`).then(e=>{this.tempArticle=e.data.article}).catch(e=>{console.log(e)}):this.tempArticle=i}},mounted(){this.getAdminArticles(),this.articleModal=new E("#articleModal")}},yt={class:"container"},vt={class:"text-end mt-4"},kt={class:"table mt-4"},xt=t("thead",null,[t("tr",null,[t("th",{style:{width:"200px"}},"標題"),t("th",{style:{width:"200px"}},"分類"),t("th",null,"描述"),t("th",{style:{width:"100px"}},"建立時間"),t("th",{style:{width:"100px"}},"是否公開"),t("th",{style:{width:"120px"}},"編輯")])],-1),Mt={key:0},Ut={key:1},Vt={class:"btn-group"},Et=["onClick"],$t=["onClick"],wt={id:"articleModal",ref:"articleModal",class:"modal fade",tabindex:"-1","aria-labelledby":"articleModalLabel","aria-hidden":"true"};function Ct(i,e,r,p,l,a){const g=A("pagination"),_=A("AdminBlogModal");return s(),n(y,null,[t("div",yt,[t("div",vt,[t("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#articleModal",onClick:e[0]||(e[0]=o=>a.selectTempArticle({tag:[],content:""}))}," 建立新的頁面 ")]),t("table",kt,[xt,t("tbody",null,[(s(!0),n(y,null,x(l.articles,o=>(s(),n("tr",{key:o.id},[t("td",null,b(o.title),1),t("td",null,b(o.author),1),t("td",null,b(o.description),1),t("td",null,b(i.$filters.date(o.create_at)),1),t("td",null,[o.isPublic?(s(),n("span",Mt,"已上架")):(s(),n("span",Ut,"未上架"))]),t("td",null,[t("div",Vt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button","data-bs-toggle":"modal","data-bs-target":"#articleModal",onClick:d=>a.selectTempArticle(o)}," 編輯 ",8,Et),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:d=>a.deleteArticle(o.id)}," 刪除 ",8,$t)])])]))),128))])]),f(g,{pages:l.pagination,onChangePage:a.getAdminArticles},null,8,["pages","onChangePage"])]),t("div",wt,[f(_,{article:l.tempArticle,"article-modal":l.articleModal,onEditArticle:a.editArticle,onAddArticle:a.addArticle},null,8,["article","article-modal","onEditArticle","onAddArticle"])],512)],64)}const It=k(ft,[["render",Ct]]);export{It as default};
